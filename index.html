<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Slither Akimmcuy.io</title>
    <style>
        body { margin: 0; overflow: hidden; background: #111; font-family: sans-serif; touch-action: none; }
        canvas { display: block; }
        #score-board { position: absolute; top: 10px; left: 10px; color: white; font-size: 18px; text-shadow: 2px 2px #000; pointer-events: none; }
        #joystick-area { position: absolute; bottom: 30px; left: 30px; width: 120px; height: 120px; background: rgba(255,255,255,0.1); border-radius: 50%; border: 2px solid rgba(255,255,255,0.3); }
        #joystick-stick { position: absolute; width: 50px; height: 50px; background: rgba(255,255,255,0.5); border-radius: 50%; top: 35px; left: 35px; }
        #game-over { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; text-align: center; display: none; background: rgba(0,0,0,0.8); padding: 20px; border-radius: 10px; border: 2px solid #00ffcc; }
    </style>
</head>
<body>

<div id="score-board">Panjang: <span id="length">10</span></div>
<div id="joystick-area"><div id="joystick-stick"></div></div>
<div id="game-over">
    <h1 style="color: #00ffcc;">KAMU MATI!</h1>
    <p>Jangan tabrak ular lain!</p>
    <button onclick="location.reload()" style="padding: 10px 20px; cursor: pointer;">MAINKAN LAGI</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const scoreEl = document.getElementById("length");
const gameOverEl = document.getElementById("game-over");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let snake = {
    pos: [{x: canvas.width/2, y: canvas.height/2}],
    angle: 0,
    speed: 3,
    size: 10,
    color: "#00ffcc"
};

let enemies = [];
let foods = [];
let joystick = { active: false, x: 0, y: 0, startX: 0, startY: 0 };

// Buat Makanan Awal
for(let i=0; i<100; i++) spawnFood();

// Buat Musuh
for(let i=0; i<5; i++) spawnEnemy();

function spawnFood() {
    foods.push({
        x: Math.random() * canvas.width * 2 - canvas.width,
        y: Math.random() * canvas.height * 2 - canvas.height,
        size: Math.random() * 3 + 2,
        color: `hsl(${Math.random() * 360}, 100%, 50%)`
    });
}

function spawnEnemy() {
    enemies.push({
        pos: [{x: Math.random()*canvas.width, y: Math.random()*canvas.height}],
        angle: Math.random() * Math.PI * 2,
        speed: 2,
        size: 8 + Math.random()*5,
        color: "#ff0055",
        length: 20 + Math.floor(Math.random()*30)
    });
}

// Kontrol Joystick
const joyArea = document.getElementById("joystick-area");
const joyStick = document.getElementById("joystick-stick");

window.addEventListener("touchstart", (e) => {
    const touch = e.touches[0];
    const rect = joyArea.getBoundingClientRect();
    if (touch.clientX > rect.left && touch.clientX < rect.right && touch.clientY > rect.top && touch.clientY < rect.bottom) {
        joystick.active = true;
        joystick.startX = rect.left + 60;
        joystick.startY = rect.top + 60;
    }
});

window.addEventListener("touchmove", (e) => {
    if (!joystick.active) return;
    const touch = e.touches[0];
    let dx = touch.clientX - joystick.startX;
    let dy = touch.clientY - joystick.startY;
    let dist = Math.sqrt(dx*dx + dy*dy);
    let maxDist = 40;
    
    if (dist > maxDist) {
        dx *= maxDist/dist;
        dy *= maxDist/dist;
    }
    
    joyStick.style.transform = `translate(${dx}px, ${dy}px)`;
    snake.angle = Math.atan2(dy, dx);
});

window.addEventListener("touchend", () => {
    joystick.active = false;
    joyStick.style.transform = `translate(0,0)`;
});

// Update & Draw
function update() {
    // Update Player
    let head = {
        x: snake.pos[0].x + Math.cos(snake.angle) * snake.speed,
        y: snake.pos[0].y + Math.sin(snake.angle) * snake.speed
    };
    snake.pos.unshift(head);
    if (snake.pos.length > snake.size) snake.pos.pop();

    // Kamera mengikuti player
    let camX = canvas.width/2 - snake.pos[0].x;
    let camY = canvas.height/2 - snake.pos[0].y;

    // Update Enemies
    enemies.forEach(en => {
        en.angle += (Math.random() - 0.5) * 0.2;
        let enHead = {
            x: en.pos[0].x + Math.cos(en.angle) * en.speed,
            y: en.pos[0].y + Math.sin(en.angle) * en.speed
        };
        en.pos.unshift(enHead);
        if (en.pos.length > en.length) en.pos.pop();

        // Cek jika player menabrak musuh
        let d = Math.hypot(snake.pos[0].x - enHead.x, snake.pos[0].y - enHead.y);
        en.pos.forEach((p, i) => {
            if(i > 2) {
                let dist = Math.hypot(snake.pos[0].x - p.x, snake.pos[0].y - p.y);
                if(dist < 15) gameOver();
            }
        });
    });

    // Makan
    foods.forEach((f, i) => {
        let dist = Math.hypot(snake.pos[0].x - f.x, snake.pos[0].y - f.y);
        if (dist < 20) {
            foods.splice(i, 1);
            snake.size += 2;
            scoreEl.innerText = Math.floor(snake.size);
            spawnFood();
        }
    });

    draw(camX, camY);
    requestAnimationFrame(update);
}

function draw(camX, camY) {
    ctx.fillStyle = "#111";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    ctx.save();
    ctx.translate(camX, camY);

    // Grid latar belakang
    ctx.strokeStyle = "#222";
    for(let x=-2000; x<2000; x+=100) {
        ctx.beginPath(); ctx.moveTo(x, -2000); ctx.lineTo(x, 2000); ctx.stroke();
    }
    for(let y=-2000; y<2000; y+=100) {
        ctx.beginPath(); ctx.moveTo(-2000, y); ctx.lineTo(2000, y); ctx.stroke();
    }

    // Gambar Makanan
    foods.forEach(f => {
        ctx.fillStyle = f.color;
        ctx.shadowBlur = 10; ctx.shadowColor = f.color;
        ctx.beginPath(); ctx.arc(f.x, f.y, f.size, 0, Math.PI*2); ctx.fill();
    });
    ctx.shadowBlur = 0;

    // Gambar Musuh
    enemies.forEach(en => {
        ctx.fillStyle = en.color;
        en.pos.forEach(p => {
            ctx.beginPath(); ctx.arc(p.x, p.y, 10, 0, Math.PI*2); ctx.fill();
        });
    });

    // Gambar Player
    ctx.fillStyle = snake.color;
    snake.pos.forEach((p, i) => {
        let s = i === 0 ? 12 : 10;
        ctx.beginPath(); ctx.arc(p.x, p.y, s, 0, Math.PI*2); ctx.fill();
        if(i===0) { // Mata
            ctx.fillStyle = "white";
            ctx.beginPath(); ctx.arc(p.x+5, p.y-5, 3, 0, Math.PI*2); ctx.fill();
            ctx.fillStyle = snake.color;
        }
    });

    ctx.restore();
}

function gameOver() {
    gameOverEl.style.display = "block";
    snake.speed = 0;
}

update();
</script>
</body>
</html>
