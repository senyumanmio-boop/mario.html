<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Super Akimmcuy Bros Ultimate</title>
    <style>
        body { margin: 0; overflow: hidden; background: #5c94fc; font-family: 'Arial Black', sans-serif; touch-action: manipulation; }
        #hud { position: absolute; top: 10px; left: 10px; color: white; text-shadow: 2px 2px #000; z-index: 10; font-size: 16px; }
        .controls { position: absolute; bottom: 20px; width: 100%; display: flex; justify-content: space-between; padding: 0 20px; box-sizing: border-box; z-index: 100; }
        .btn { width: 65px; height: 65px; background: rgba(0,0,0,0.5); border-radius: 50%; display: flex; justify-content: center; align-items: center; color: white; border: 2px solid white; font-size: 20px; }
        #win-screen { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: black; color: yellow; padding: 30px; text-align: center; display: none; z-index: 200; border: 5px solid gold; }
    </style>
</head>
<body>
    <div id="hud">LVL: <span id="lvl">1</span> | COINS: <span id="cns">0</span></div>
    <div id="win-screen"><h1>COURSE CLEAR! üèÅ</h1><p>Gila Lu Jago Banget!</p></div>

    <div class="controls">
        <div style="display:flex; gap:15px;">
            <div class="btn" id="btn-left">‚óÄ</div>
            <div class="btn" id="btn-down">‚ñº</div>
            <div class="btn" id="btn-right">‚ñ∂</div>
        </div>
        <div class="btn" id="btn-jump" style="width:90px; height:90px; background: rgba(255,0,0,0.5);">JUMP</div>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let currentLevel = 1;
let coins = 0;
let cameraX = 0;
let isWinnning = false;
let isUnderground = false;

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

const player = {
    x: 50, y: 100, w: 35, h: 50,
    vx: 0, vy: 0, speed: 6, jump: -17,
    grounded: false
};

let platforms = [];
let items = [];
let enemies = [];

function buildLevel(lvl) {
    platforms = []; items = []; enemies = [];
    player.x = 50; player.y = 100; cameraX = 0; isUnderground = false;
    document.body.style.background = "#5c94fc";

    // Tanah Utama
    for(let i=0; i<5000; i+=600) {
        platforms.push({x: i, y: canvas.height-60, w: 450, h: 60, type: 'ground'});
    }

    // Tambah Koin Melayang
    for(let i=500; i<4000; i+=300) {
        items.push({x: i, y: canvas.height-200, w: 20, h: 20, type: 'coin', collected: false});
    }

    // Platform Bergerak (Naik Turun)
    platforms.push({x: 1200, y: canvas.height-200, w: 100, h: 20, type: 'moving', baseAt: canvas.height-200, range: 100, speed: 0.05});

    // Pipa Rahasia (Bisa Masuk Bawah Tanah)
    platforms.push({x: 800, y: canvas.height-140, w: 80, h: 80, type: 'pipe', canEnter: true});

    // Istana Finish
    platforms.push({x: 4500, y: canvas.height-310, w: 250, h: 250, type: 'castle'});
}

// Kontrol
const keys = {};
let tL=0, tR=0, tJ=0, tD=0;
document.getElementById('btn-left').ontouchstart = () => tL=1; document.getElementById('btn-left').ontouchend = () => tL=0;
document.getElementById('btn-right').ontouchstart = () => tR=1; document.getElementById('btn-right').ontouchend = () => tR=0;
document.getElementById('btn-jump').ontouchstart = () => tJ=1; document.getElementById('btn-jump').ontouchend = () => tJ=0;
document.getElementById('btn-down').ontouchstart = () => tD=1; document.getElementById('btn-down').ontouchend = () => tD=0;

function enterUnderground() {
    isUnderground = true;
    document.body.style.background = "#000";
    player.x = 100; player.y = 50;
    platforms = [
        {x: 0, y: canvas.height-60, w: 2000, h: 60, type: 'ground'},
        {x: 1500, y: canvas.height-140, w: 80, h: 80, type: 'pipe', exit: true}
    ];
    items = [];
    for(let i=200; i<1400; i+=100) items.push({x: i, y: canvas.height-150, w: 20, h: 20, type: 'coin', collected: false});
}

function update() {
    if(isWinnning) return;
    
    player.vx = (keys["ArrowRight"] || tR) ? player.speed : (keys["ArrowLeft"] || tL) ? -player.speed : 0;
    player.vy += 0.8;

    // Gerak Platform
    platforms.forEach(p => {
        if(p.type === 'moving') {
            p.y = p.baseAt + Math.sin(Date.now() * p.speed * 0.1) * p.range;
        }
    });

    // Collision Logic
    player.x += player.vx;
    platforms.forEach(p => {
        if(player.x < p.x+p.w && player.x+player.w > p.x && player.y < p.y+p.h && player.y+player.h > p.y) {
            if(p.type === 'castle') { win(); return; }
            if(p.canEnter && (keys["ArrowDown"] || tD)) { enterUnderground(); return; }
            if(p.exit && (keys["ArrowDown"] || tD)) { buildLevel(currentLevel); return; }
            if(player.vx > 0) player.x = p.x - player.w; else player.x = p.x + p.w;
        }
    });

    player.grounded = false;
    player.y += player.vy;
    platforms.forEach(p => {
        if(player.x < p.x+p.w && player.x+player.w > p.x && player.y < p.y+p.h && player.y+player.h > p.y) {
            if(p.type === 'castle') return;
            if(player.vy > 0) { player.y = p.y - player.h; player.vy = 0; player.grounded = true; }
            else { player.y = p.y + p.h; player.vy = 2; }
        }
    });

    // Ambil Koin
    items.forEach(c => {
        if(!c.collected && player.x < c.x+c.w && player.x+player.w > c.x && player.y < c.y+c.h && player.y+player.h > c.y) {
            c.collected = true; coins++; document.getElementById('cns').innerText = coins;
        }
    });

    if((keys["ArrowUp"] || keys[" "] || tJ) && player.grounded) player.vy = player.jump;
    cameraX = player.x - canvas.width/4;
    if(player.y > canvas.height) { player.x=50; player.y=100; }
    
    draw();
    requestAnimationFrame(update);
}

function win() {
    isWinnning = true; document.getElementById('win-screen').style.display='block';
    setTimeout(() => { 
        currentLevel++; buildLevel(currentLevel); 
        document.getElementById('lvl').innerText=currentLevel;
        isWinnning=false; document.getElementById('win-screen').style.display='none';
    }, 3000);
}

function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.save(); ctx.translate(-cameraX, 0);

    platforms.forEach(p => {
        if(p.type === 'ground') { ctx.fillStyle = "#70483c"; ctx.fillRect(p.x, p.y, p.w, p.h); ctx.fillStyle="#3cb043"; ctx.fillRect(p.x,p.y,p.w,10); }
        else if(p.type === 'pipe') { ctx.fillStyle = "#32cd32"; ctx.fillRect(p.x, p.y, p.w, p.h); ctx.strokeRect(p.x, p.y, p.w, p.h); }
        else if(p.type === 'castle') { ctx.fillStyle = "#444"; ctx.fillRect(p.x, p.y, p.w, p.h); ctx.fillStyle="black"; ctx.fillRect(p.x+100, p.y+150, 50, 100); }
        else { ctx.fillStyle="#ffcc33"; ctx.fillRect(p.x,p.y,p.w,p.h); }
    });

    items.forEach(c => {
        if(!c.collected) { ctx.fillStyle = "gold"; ctx.beginPath(); ctx.arc(c.x+10, c.y+10, 10, 0, Math.PI*2); ctx.fill(); }
    });

    // Mario Akimmcuy
    ctx.fillStyle = "red"; ctx.fillRect(player.x, player.y, player.w, 25);
    ctx.fillStyle = "blue"; ctx.fillRect(player.x, player.y+25, player.w, 25);
    ctx.fillStyle = "#ffcc99"; ctx.fillRect(player.x+10, player.y+5, 20, 15);

    ctx.restore();
}

window.addEventListener("keydown", e => keys[e.key] = true);
window.addEventListener("keyup", e => keys[e.key] = false);
buildLevel(1); update();
</script>
</body>
</html>
