<!DOCTYPE html>
<html>
<head>
    <title>Super Akimmcuy Bros - Hard Mode</title>
    <style>
        body { margin: 0; overflow: hidden; background: #5c94fc; font-family: 'Arial Black', sans-serif; }
        #hud { position: absolute; top: 20px; left: 20px; color: white; text-shadow: 2px 2px #000; font-size: 20px; z-index: 100; }
        #msg { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: yellow; font-size: 50px; text-shadow: 5px 5px #000; display: none; z-index: 100; }
    </style>
</head>
<body>
    <div id="hud">MARIO AKIMMCUYY | COINS: <span id="coins">0</span></div>
    <div id="msg">YOU WIN! üèÜ</div>
    <canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let coins = 0;
let cameraX = 0;
let win = false;

const player = {
    x: 100, y: 100, w: 35, h: 50,
    vx: 0, vy: 0, speed: 6, jump: -16,
    grounded: false
};

// --- DESIGN LEVEL (Platform, Pipa, Jurang) ---
const platforms = [
    // Lantai Awal
    {x: 0, y: canvas.height - 60, w: 1000, h: 60, type: 'ground'},
    // Rintangan Kotak & Bata
    {x: 400, y: canvas.height - 200, w: 40, h: 40, type: 'block', hit: false},
    {x: 440, y: canvas.height - 200, w: 40, h: 40, type: 'brick'},
    {x: 480, y: canvas.height - 200, w: 40, h: 40, type: 'block', hit: false},
    // Pipa-Pipa
    {x: 700, y: canvas.height - 140, w: 70, h: 80, type: 'pipe'},
    {x: 900, y: canvas.height - 180, w: 70, h: 120, type: 'pipe'},
    
    // JURANG PERTAMA & Lantai Berikutnya
    {x: 1150, y: canvas.height - 60, w: 500, h: 60, type: 'ground'},
    {x: 1300, y: canvas.height - 220, w: 120, h: 30, type: 'brick'},
    
    // TANGGA SUSAH
    {x: 1750, y: canvas.height - 100, w: 50, h: 40, type: 'brick'},
    {x: 1800, y: canvas.height - 140, w: 50, h: 80, type: 'brick'},
    {x: 1850, y: canvas.height - 180, w: 50, h: 120, type: 'brick'},
    {x: 1900, y: canvas.height - 220, w: 50, h: 160, type: 'brick'},
    
    // LANTAI TERAKHIR
    {x: 2100, y: canvas.height - 60, w: 800, h: 60, type: 'ground'},
    // TIANG FINISH
    {x: 2700, y: canvas.height - 360, w: 10, h: 300, type: 'finish'}
];

const enemies = [
    {x: 600, y: canvas.height - 100, w: 40, h: 40, vx: -2, alive: true, range: [400, 700]},
    {x: 1400, y: canvas.height - 100, w: 40, h: 40, vx: -3, alive: true, range: [1150, 1600]},
    {x: 2300, y: canvas.height - 100, w: 40, h: 40, vx: -4, alive: true, range: [2100, 2600]}
];

const keys = {};

function checkCollision(obj, p) {
    let dx = (obj.x + obj.w / 2) - (p.x + p.w / 2);
    let dy = (obj.y + obj.h / 2) - (p.y + p.h / 2);
    let width = (obj.w + p.w) / 2;
    let height = (obj.h + p.h) / 2;
    let crossWidth = width * dy;
    let crossHeight = height * dx;

    if (Math.abs(dx) <= width && Math.abs(dy) <= height) {
        if (crossWidth > crossHeight) {
            return (crossWidth > (-crossHeight)) ? 'top' : 'right';
        } else {
            return (crossWidth > (-crossHeight)) ? 'left' : 'bottom';
        }
    }
    return null;
}

function update() {
    if (win) return;

    if (keys["ArrowRight"]) player.vx = player.speed;
    else if (keys["ArrowLeft"]) player.vx = -player.speed;
    else player.vx = 0;

    if ((keys["ArrowUp"] || keys[" "]) && player.grounded) {
        player.vy = player.jump;
        player.grounded = false;
    }

    player.vy += 0.8; 
    player.x += player.vx;
    player.y += player.vy;

    cameraX = player.x - canvas.width / 3;
    player.grounded = false;

    // Platform & Solid Collision
    platforms.forEach(p => {
        let col = checkCollision(player, p);
        if (col) {
            if (p.type === 'finish') {
                win = true;
                document.getElementById('msg').style.display = 'block';
                return;
            }
            if (col === 'bottom') {
                player.y = p.y - player.h;
                player.vy = 0;
                player.grounded = true;
            } else if (col === 'top') {
                player.y = p.y + p.h;
                player.vy = 5;
                if (p.type === 'block' && !p.hit) {
                    p.hit = true; coins++;
                    document.getElementById('coins').innerText = coins;
                }
            } else if (col === 'left') {
                player.x = p.x - player.w;
            } else if (col === 'right') {
                player.x = p.x + p.w;
            }
        }
    });

    // Jatuh ke Jurang
    if (player.y > canvas.height) {
        player.x = 100; player.y = 100; player.vy = 0;
    }

    // Enemy logic
    enemies.forEach(e => {
        if (!e.alive) return;
        e.x += e.vx;
        if (e.x < e.range[0] || e.x > e.range[1]) e.vx *= -1;

        if (checkCollision(player, e)) {
            if (player.vy > 0 && player.y < e.y) {
                e.alive = false;
                player.vy = -12;
            } else {
                player.x = 100; player.y = 100;
            }
        }
    });

    draw();
    requestAnimationFrame(update);
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.save();
    ctx.translate(-cameraX, 0);

    platforms.forEach(p => {
        if (p.type === 'ground') ctx.fillStyle = "#70483c";
        else if (p.type === 'pipe') ctx.fillStyle = "#32cd32";
        else if (p.type === 'block') ctx.fillStyle = p.hit ? "#8a6d00" : "#ffcc33";
        else if (p.type === 'finish') ctx.fillStyle = "white";
        else ctx.fillStyle = "#a52a2a";
        
        ctx.fillRect(p.x, p.y, p.w, p.h);
        ctx.strokeStyle = "black";
        ctx.strokeRect(p.x, p.y, p.w, p.h);
        
        if(p.type === 'finish') {
            ctx.fillStyle = "red"; ctx.fillRect(p.x - 30, p.y, 30, 40);
        }
    });

    enemies.forEach(e => {
        if (!e.alive) return;
        ctx.fillStyle = "#5c2e0e"; // Goomba
        ctx.fillRect(e.x, e.y, e.w, e.h);
        ctx.fillStyle = "white"; ctx.fillRect(e.x+5, e.y+5, 8, 8); ctx.fillRect(e.x+25, e.y+5, 8, 8);
    });

    // Mario
    ctx.fillStyle = "red"; ctx.fillRect(player.x, player.y, player.w, 30);
    ctx.fillStyle = "blue"; ctx.fillRect(player.x, player.y + 30, player.w, 20);
    ctx.fillStyle = "#ffcc99"; ctx.fillRect(player.x + 10, player.y + 5, 20, 20);
    ctx.fillStyle = "darkred"; ctx.fillRect(player.x - 5, player.y, player.w + 10, 8);

    ctx.restore();
}

window.addEventListener("keydown", e => keys[e.key] = true);
window.addEventListener("keyup", e => keys[e.key] = false);
update();
</script>
</body>
</html>
